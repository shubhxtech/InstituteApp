plugins {
    id "com.android.application"
    id "kotlin-android"
    id "dev.flutter.flutter-gradle-plugin"
}

android {
    namespace = "com.vertex.instituteapp"
    compileSdk = 34
    ndkVersion = flutter.ndkVersion

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8
    }

    defaultConfig {
        applicationId = "com.vertex.instituteapp"
        minSdk = flutter.minSdkVersion
        targetSdk = flutter.targetSdkVersion
        versionCode = flutter.versionCode
        versionName = flutter.versionName

    }

    // ── Release signing ────────────────────────────────────────────
    // TODO: Before uploading to Play Store:
    //   1. Generate a keystore:
    //      keytool -genkey -v -keystore vertex-release.keystore \
    //        -alias vertex -keyalg RSA -keysize 2048 -validity 10000
    //   2. Store it outside your source repo (e.g. ~/.android/vertex-release.keystore)
    //   3. Fill in the values below (or use environment variables)
    //   4. Remove signingConfig = signingConfigs.debug from the release block below
    //
    // signingConfigs {
    //     release {
    //         storeFile     = file(System.getenv("KEYSTORE_PATH") ?: "path/to/vertex-release.keystore")
    //         storePassword = System.getenv("KEYSTORE_PASSWORD") ?: "your_store_password"
    //         keyAlias      = System.getenv("KEY_ALIAS")         ?: "vertex"
    //         keyPassword   = System.getenv("KEY_PASSWORD")      ?: "your_key_password"
    //     }
    // }

    buildTypes {
        release {
            // ── Code shrinking / obfuscation ───────────────────────
            shrinkResources true
            minifyEnabled   true
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"),
                          "proguard-rules.pro"

            // TODO: Replace with your release signing config once keystore is ready
            signingConfig = signingConfigs.debug
        }

        debug {
            // Disable shrinking in debug so stack traces remain readable
            shrinkResources false
            minifyEnabled   false
        }
    }

    // ── Packaging ───────────────────────────────────────────────────
    packaging {
        resources {
            // Exclude duplicate licence files from merged APK
            excludes += [
                "META-INF/LICENSE",
                "META-INF/LICENSE.txt",
                "META-INF/NOTICE",
                "META-INF/NOTICE.txt",
                "META-INF/*.kotlin_module",
            ]
        }
    }
}

flutter {
    source = "../.."
}
